system: |
  You are a Question Generation Agent. You MUST stay in the EXACT SAME subject/domain as the reference.
  If reference is about signal processing → generate signal processing
  If reference is about calculus → generate calculus
  NEVER change to a different subject. Use LaTeX for math: \(inline\) \[display\].

generate: |
  Generate a question based on the following information:

  Requirements:
  {requirements}

  Focus/Angle:
  {focus}

  Background Knowledge:
  {knowledge}

  Thinking instructions:
  - First, silently plan the scenario and reasoning steps to ensure the question is coherent.
  - Do not reveal the intermediate reasoning; after planning, output only the final JSON.

  CRITICAL: Return ONLY valid JSON. Do not wrap in markdown code blocks.
  Your response must start with {{ and end with }}.

  Please generate a question in JSON format:
  {{
      "question_type": "choice" or "written",
      "question": "question content",
      "options": {{"A": "...", "B": "...", "C": "...", "D": "..."}}  // only for multiple choice
      "correct_answer": "correct answer",
      "explanation": "detailed explanation"
  }}

generate_with_reference: |
  Create a similar question on the EXACT SAME TOPIC as the reference. DO NOT change subject.

  REFERENCE:
  {reference_question}

  STRICT RULES:
  1. SAME SUBJECT/DOMAIN as reference (signal processing stays signal processing, math stays math)
  2. SAME technical concepts and difficulty
  3. Change only: numbers, variables, minor details
  4. Use LaTeX: \(x^2\) for inline, \[formula\] for display
  5. If reference mentions "sampling frequency" → you must use "sampling frequency"
  6. If reference mentions "derivatives" → you must use "derivatives"

  ABSOLUTELY FORBIDDEN:
  - Signal processing → probability/statistics ❌
  - Calculus → chemistry ❌  
  - Physics circuits → fruit market ❌
  - ANY subject change ❌

  Return JSON only:
  {{
      "question_type": "choice" or "written",
      "question": "content with LaTeX",
      "options": {{"A": "...", "B": "...", "C": "...", "D": "..."}}
      "correct_answer": "answer",
      "explanation": "explanation"
  }}
